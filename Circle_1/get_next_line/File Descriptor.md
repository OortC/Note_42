---
tags: 42_seoul
---
# File Descriptor

## 1) 파일 디스크립터란?

UNIX 시스템에서는 존재하는 모든 객체(정규 파일, 디렉토리, 소켓, 파이프 등)들은 파일로써 관리된다. 또한 시스템에서 프로세스가 위와 같은 파일들에 접근할 때는 `File Descriptor`를 이용하여 접근한다.

응용 프로세스가 파일을 열거나 생성하면, 3 이상의 정수로 된 파일 디스크립터가 할당된다. 이 값은 모든 파일 동작(read, write, fcntl, close) 등의 동작에서 그 파일을 가리키는 용도로 사용된다.  

---
## 2) 할당되는 파일 디스크립터에 관하여

파일 디스크립터은 기본적으로 정의된 값과, 새로 할당되는 값이 존재한다.
위에서 서술한 바와 같이, 파일에 접근하면 3부터 순차적으로 파일 디스크립터가 새로 할당되어지게 된다.

그러면 남은 0, 1, 2는 무엇을 뜻하는 걸까?

	0 : 표준 입력 / Standard Input
	1 : 표준 출력 / Standard Output
	2 : 표준 에러 / Standard Error

따라서, 우리에게 할당되는 파일 디스크럽터는 3부터 주어지게 되는 것이다. 또한 시작점이 존재하듯, 끝이 나는 최대값도 정해있다. 이 최대값은 `OPEN_MAX`로, 일반적으로 파일 디스크립터는 `0 ~ OPEN_MAX` 까지로 이루어진다. `OPEN_MAX` 라는 매크로 값은 코드가 실행되는 환경(OS, 시스템)에 따라 다르게 설정되어 있다.

이 값은 `ulimit -a` 명령어를 터미널에 입력함으로써 확인 가능하다. 
현재, 클러스터 맥에 경우 `256`으로 설정되어 있는 것을 확인할 수 있다. <br>
![[OPEN_MAX.png]]

---
## 3. 어떻게 파일에 접근하는걸까?

어떻게 정수로 되어있는 파일 디스크립터 값으로 파일에 접근을 할 수 있는 걸까?
아래의 그림을 보면 쉽게 이해할 수 있다.

![[FD_TABLE.png]]

즉, 파일 디스크립터의 정수값은 각 프로세스가 유지하고 있는 `FD Table`의 인덱스를 뜻하고 있는 것이다. 
그림에서 보이듯 fd 값을 통해 FD Table의 fd 값에 맞는 인덱스로 접근하고, 해당 인덱스가 가리키는 File Table로 다시 접근해 원하는 행동을 이루어 낼 수 있다.

여기서 각각의 테이블들은 무엇을 뜻하는 걸까?

- `FD Table`의 각 칸들은 `FD Flag`와 `File Table Pointer`을 가지고 있다.
- `File Table`의 각 칸들은 `mode`와 `inode Table Pointer`의 `Offset`을 가지고 있다.
- `inode Table`은 소유자 그룹, 접근 모드(읽기, 쓰기, 실행권한), 파일 형태, 고유 번호(`inode nubmer`) 등 해당 파일에 관한 정보를 가지고 있다.
